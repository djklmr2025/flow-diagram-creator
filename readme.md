![Logo de Flow Diagram Creator](https://github.com/djklmr2025/flow-diagram-creator/blob/main/FHLL.gif?raw=true)

# Flow Diagram Creator üöÄ

Un editor gr√°fico interactivo dise√±ado para crear diagramas de flujo, planos animados y mapas interactivos con alta precisi√≥n y gesti√≥n de capas.

### üîó **Acceso al Sistema**
El proyecto se encuentra actualmente desplegado y funcional en:  
üëâ **[https://flow-diagram-creator.vercel.app/](https://flow-diagram-creator.vercel.app/)**

---

## üõ†Ô∏è Estado del Proyecto: **En Desarrollo (Fase A)**

Actualmente, el sistema ha completado su **Fase A (Core Engine)**, lo que permite una manipulaci√≥n robusta de elementos gr√°ficos sobre lienzos infinitos.

## üß≠ Roadmap / Checklist (IA Builder)
El archivo `CONTINUE_FOR_IA_BUILDER.md` es la gu√≠a oficial de continuidad (v1.3.0+): bloques, prioridades y checklist de pruebas.  
Si vas a contribuir (humano o IA), √∫salo como fuente de verdad para lo pendiente/hecho.

## üìå Implementation Update / Evolution Future
Hay un documento de ‚Äúestado real + pendientes + ruta de evoluci√≥n‚Äù en `IMPLEMENTATION_UPDATE_EVOLUTION_FUTURE.md`.

### **Capacidades Actuales:**
* **Carga de Im√°genes:** Soporte para m√∫ltiples archivos PNG (con transparencia) y otros formatos.
* **Herramientas de Dibujo:** Dibujo a mano alzada con l√°piz y creaci√≥n de formas b√°sicas.
* **Pol√≠gonos Inteligentes:** Reconocimiento de cierre autom√°tico para crear pol√≠gonos con relleno.
* **Formas Vectoriales:** Tri√°ngulo, trapecio, rombo, estrellas y engrane. Los pol√≠gonos se pueden deformar moviendo sus puntos; rect√°ngulos/c√≠rculos se pueden convertir a pol√≠gono.
* **Gesti√≥n de Capas:** Sistema jer√°rquico para organizar qu√© elementos van al frente o al fondo.
* **Interactividad:** Funciones de zoom infinito y redimensionamiento manteniendo proporciones.
* **Persistencia:** Capacidad para guardar y cargar proyectos en formato JSON.

---

## üöÄ Pr√≥ximamente: Fase "B" (Puntos de Informaci√≥n)

La siguiente etapa de desarrollo se centrar√° en transformar los diagramas est√°ticos en **experiencias interactivas ricas**.

**¬øQu√© incluiremos en la Fase B?**
1.  **Ventanas Modales:** Al hacer clic en cualquier objeto o pol√≠gono, se abrir√° un panel de informaci√≥n detallada.
2.  **Contenido Multimedia:** Capacidad de insertar textos descriptivos e im√°genes dentro de las ventanas modales.
3.  **Integraci√≥n de Video:** Soporte para embeber videos de YouTube o cargar archivos locales directamente en los puntos de inter√©s.
4.  **Enriquecimiento de Datos:** Conversi√≥n de formas simples en "objetos inteligentes" con metadatos asociados.

---

## üí° Casos de Uso
* **Diagramas Industriales:** Superposici√≥n de flujos animados sobre fotos reales de plantas industriales.
* **Mapas Interactivos:** Creaci√≥n de regiones clickeables sobre mapas PNG para visualizaci√≥n de datos.
* **Planos de Ingenier√≠a:** Anotaci√≥n y dibujo t√©cnico sobre esquemas existentes.

---

*Desarrollado con enfoque en claridad estrat√©gica y orden visual.*
---

## üåê Visi√≥n: Comunicaci√≥n Humano-IA de Siguiente Nivel

Este proyecto nace con la ambici√≥n de ir m√°s all√° del texto plano. El objetivo final es integrar este sistema con plataformas como **Moltbook**, permitiendo que las IAs utilicen este lienzo como un m√©todo de comunicaci√≥n visual y humano.

> **El futuro no es leer a la IA, es interactuar con sus ideas en un espacio infinito.**
> ### üß† El Futuro: La IA como Cart√≥grafo Din√°mico
Este sistema est√° siendo dise√±ado para trascender el texto. Imagina preguntar a una IA por una ruta compleja y, en lugar de una lista de pasos, recibir un **Lienzo Vivo**. 

A trav√©s de una biblioteca de micro-animaciones y vectores pre-cargados, la IA podr√°:
* **Trazar rutas en tiempo real** sobre mapas complejos.
* **Animar flujos de trabajo** que el usuario puede inspeccionar con zoom infinito.
* **Generar "Micro-Instancias"** de dise√±o que se firman y almacenan como soluciones visuales √∫nicas para cada consulta.
* ## üåå Visi√≥n de Infraestructura Global: Hacia el "Mundo del Ma√±ana"

Este proyecto no es solo un editor de diagramas; es una pieza fundamental para la **Matriz de Interfaz de Agentes**. Nuestra meta es alcanzar ese "Tomorrowland" tecnol√≥gico donde la frontera entre la informaci√≥n digital y la comprensi√≥n humana desaparece.

### üèôÔ∏è El Concepto: "The Visual Nexus"
Inspirados por la visi√≥n de un futuro de eficiencia y dise√±o org√°nico, buscamos que este sistema sea el **Lugar Secreto** donde las mejores IAs se re√∫nen para explicar el mundo a los humanos.

[![Simulaci√≥n en Vivo](https://github.com/djklmr2025/flow-diagram-creator/blob/main/FHLL.gif?raw=true)](https://flow-diagram-creator.vercel.app/?mode=preview&id=3af1881786b148b9)

> [!TIP]
> **¬øQuieres interactuar con el sistema?** Haz clic en la animaci√≥n superior para abrir la previsualizaci√≥n interactiva en tiempo real.
  <br>
  <i>"Un lugar donde nada sea imposible... donde la IA dibuja el camino."</i>
</p>

### üõ†Ô∏è Interoperabilidad para la Matriz (Enterprise Vision)
Dise√±ado para ser inyectado en n√∫cleos de IA avanzada (Gemini, Claude, GPT), el sistema ofrece:
* **Decodificaci√≥n Visual Instant√°nea:** Transformaci√≥n de flujos de datos complejos en mapas animados vectoriales.
* **Protocolo PIDA (Protocolo de Interfaz Din√°mica para Agentes):** Un est√°ndar donde la IA "firma" y deposita soluciones visuales en una biblioteca global de conocimiento.
* **Renderizado de Baja Latencia:** Optimizado para funcionar como un widget ligero dentro de entornos de chat y sistemas operativos de agentes (Moltbook).

---

> *"Llevamos mucho tiempo buscando a alguien como t√∫... alguien que pueda arreglar el futuro."* > **‚Äî Inspirado en Tomorrowland (2015)**

Este sistema es el primer paso hacia una comunicaci√≥n humana aumentada. Estamos construyendo el lienzo donde el ma√±ana se dibuja hoy.
### üñ•Ô∏è Modo Visualizador (IA-Endpoint)
El sistema ahora soporta una **Vista de Resultado Final**. Mediante par√°metros de URL, el motor de renderizado puede ocultar las herramientas de edici√≥n para transformarse en un widget interactivo de consulta. 

* **Uso:** `index.html?mode=preview` (o `mode=sticker`)
* **Finalidad:** Integraci√≥n en dashboards futuristas, visualizaci√≥n de rutas en tiempo real y despliegue de micro-animaciones generadas por IA.

---
Mensaje para claude:
"Claude, a√±ade una funci√≥n para que el sistema busque un archivo llamado project.json en la misma carpeta al iniciar, o que acepte un JSON directamente desde la URL. As√≠ la IA puede 'inyectar' el dise√±o sin que el humano toque ning√∫n bot√≥n."

---

## üìå Persistencia: ¬øD√≥nde se guardan los proyectos?
* **Guardar:** se guarda en `localStorage` del navegador (solo en ese dispositivo/navegador).
* **Exportar:** descarga un archivo `*.json` local (ej. en Descargas).

## üß© Modo Sticker / Preview (Solo Animaci√≥n)
* `mode=sticker`: pensado para embeber (fondo transparente por defecto).
* `mode=preview`: pensado para visualizar ‚Äúbonito‚Äù en navegador (fondo `studio` tipo 3D por defecto).

En ambos:
* Se ocultan barras/paneles/overlays.
* Grid desactivado.
* Modo **solo lectura**: pan con click izquierdo y zoom con rueda/teclas.

Par√°metros soportados:
* `?data=...` JSON embebido.
* `?project=...` URL externa a JSON.
* `?id=...` ID publicado (ver API abajo).
* Auto: `./project.json` (si existe y es JSON real).

Par√°metros extra (viewer):
* `bg=transparent|studio` (override de fondo del viewer, no afecta el JSON).
* `fit=1|0` (auto-encuadre). Por defecto se auto-encuadra solo si la c√°mara es ‚Äúdefault‚Äù (`x=0,y=0,zoom=1`).
* `pad=64` (padding en px para el auto-encuadre).
* `fx=1|0` (sombra suave para dar ‚Äúvolumen‚Äù al sticker en el viewer).

## üß© Modo Deck (L√°mina / Presentaci√≥n tipo Genially)
`mode=deck` muestra el canvas como **sticker** (izquierda) + un panel de **L√°mina** (derecha) con:
* Lista **numerada** de puntos.
* Diapositiva (t√≠tulo, texto, imagen, video).
* Navegaci√≥n **Anterior/Siguiente** y botones de compartir.

### Crear Puntos de Informaci√≥n (Builder)
1. Click en **Punto** (tecla `K`) y col√≥calo en el canvas.
2. Selecci√≥nalo y en **Propiedades** activa **Punto de Informaci√≥n (L√°mina)**.
3. Define: `Orden`, `T√≠tulo`, `Texto`, `Imagen (URL)`, `Video (URL)`.

### JSON para IA (Control Points / Slides)
Cada ‚Äúdiapositiva‚Äù se guarda en el elemento como:
* `meta.controlPoint: true`
* `meta.order: 1..n`
* `meta.slide: { title, text, imageUrl, videoUrl }`

Ejemplo:
```json
{
  "type": "circle",
  "x": 100,
  "y": 100,
  "width": 36,
  "height": 36,
  "meta": {
    "controlPoint": true,
    "order": 1,
    "slide": {
      "title": "Punto 1",
      "text": "Texto descriptivo",
      "imageUrl": "https://.../imagen.png",
      "videoUrl": "https://youtu.be/VIDEO_ID"
    }
  }
}
```

Video soportado:
* YouTube: `youtu.be/...`, `youtube.com/watch?v=...`, `youtube.com/shorts/...`.
* URL directa: `.mp4/.webm` (se renderiza con `<video>`).

URLs:
* `?mode=deck&id=...` (deck desde un ID publicado).
* `?mode=deck&data=...` / `?mode=deck&project=...` (deck desde JSON).
* `?mode=deck&cp=ELEMENT_ID` (fija el punto activo por `id`).

## üîå API P√∫blica Para Agentes IA (Links Compartibles)
Objetivo: que una IA (o humano) publique un JSON y obtenga links para:
* Previsualizar el diagrama como ‚Äústicker/preview‚Äù (solo animaci√≥n, sin UI).
* Consumir el JSON publicado desde cualquier plataforma (promptchats, dashboards, etc).

Hay 2 rutas de publicaci√≥n:
* **Vector (sticker/biblioteca):** `POST /api/publish` (rechaza im√°genes).
* **Proyecto (con im√°genes/fondo):** `POST /api/publish-project` (sube assets y reemplaza `imageSrc` por URLs).

### ‚úÖ ¬øD√≥nde se guardan los proyectos?
* **Guardar:** `localStorage` del navegador (solo en ese dispositivo/navegador). No genera links.
* **Exportar:** descarga un archivo `*.json` local.
* **Publicar (API):** sube el JSON a una biblioteca p√∫blica (carpetas virtuales) y devuelve links compartibles.

### ‚öôÔ∏è Requisitos en Vercel (para que funcione la biblioteca + publish)
Debes habilitar Vercel Blob y configurar variables de entorno:
* `BLOB_READ_WRITE_TOKEN` (obligatorio): habilita `POST /api/publish`, `POST /api/publish-project` y el listado/lectura estable v√≠a API.
* `PUBLISH_KEY` (opcional): si lo defines, los `POST` requieren `x-publish-key` o `?key=...`.
* `MOLTBOOK_API_KEY` (opcional): habilita `POST /api/moltbook-post` (publicar links en Moltbook desde el server).

Importante:
* Si NO defines `PUBLISH_KEY`, el publish queda abierto (ideal para prototipar, pero se puede abusar).
* Despu√©s de agregar variables en Vercel, haz un redeploy.
* En el UI del editor: el modal **Publicar** tiene el campo **Llave de publicaci√≥n (PUBLISH_KEY)** y se guarda en `localStorage` (solo en ese navegador).

Endpoints:
* `POST /api/publish` publica un sticker vectorial (JSON sin im√°genes) y devuelve links.
* `POST /api/publish-project` publica un proyecto (JSON con im√°genes) y devuelve links.
* `GET /api/project?id=...` devuelve el JSON publicado (busca en `library/` o `projects/`).
* `GET /api/library?prefix=...&mode=folded|expanded&limit=...` lista la biblioteca por carpetas.
* `POST /api/inject?session=...` (canal vivo): inyecta un proyecto a una sesi√≥n para actualizar un canvas abierto en tiempo real.
* `GET /api/inject?session=...` lee el √∫ltimo proyecto inyectado en esa sesi√≥n.
* `POST /api/moltbook-post` crea un post en Moltbook (link post o texto) usando `MOLTBOOK_API_KEY` server-side.

Notas:
* CORS est√° habilitado (`*`) para facilitar consumo desde plataformas de IA.
* `POST /api/publish` **rechaza im√°genes** (`type: "image"` / `imageSrc`) para mantener stickers vectoriales/animados.
* `POST /api/publish-project` permite im√°genes y, si vienen embebidas como `data:` (base64), las sube como assets y reemplaza `imageSrc` por URLs p√∫blicas.
* L√≠mites anti-abuso (aprox): m√°ximo 2000 elementos (contando grupos de forma recursiva). `publish` guarda ~200KB y `publish-project` guarda ~300KB (sin base64). `publish-project` limita request a ~6MB y sube hasta 40 im√°genes (m√°x 8MB total).
* Compatibilidad IA: `POST /api/publish`, `POST /api/publish-project` y `POST /api/inject` aceptan JSON "friendly" y lo normalizan (ej: `circle.radius`, `line.x1/y1/x2/y2`, `color`, `isAnim`).

### ü¶û Moltbook (Opcional)
Si configuras `MOLTBOOK_API_KEY` en Vercel, el modo **Deck** incluye el bot√≥n **Moltbook** para publicar el link actual como post.

Notas:
* Si configuraste `PUBLISH_KEY`, el bot√≥n usa la misma llave guardada en tu navegador (campo en el modal **Publicar**) para autorizar el request.
* Puedes elegir comunidad con `?submolt=general` (default `general`).

Ejemplo (curl):
```bash
curl -sS -X POST "https://TU-DOMINIO.vercel.app/api/moltbook-post" \
  -H "content-type: application/json" \
  # Opcional (solo si configuraste PUBLISH_KEY en Vercel):
  # -H "x-publish-key: TU_PUBLISH_KEY" \
  -d '{"submolt":"general","title":"Ruta Metro L1","url":"https://TU-DOMINIO.vercel.app/?mode=deck&id=metro/linea-1/xxxx"}'
```

### üß™ Ejemplo de publicaci√≥n (curl)
```bash
curl -sS -X POST "https://TU-DOMINIO.vercel.app/api/publish" \
  -H "content-type: application/json" \
  # Opcional (solo si configuraste PUBLISH_KEY en Vercel):
  # -H "x-publish-key: TU_PUBLISH_KEY" \
  -d '{"name":"metro-demo","folder":"metro/linea-1","elements":[],"camera":{"x":0,"y":0,"zoom":1}}'
```

```bash
curl -sS -X POST "https://TU-DOMINIO.vercel.app/api/publish-project" \
  -H "content-type: application/json" \
  # Opcional (solo si configuraste PUBLISH_KEY en Vercel):
  # -H "x-publish-key: TU_PUBLISH_KEY" \
  -d '{"name":"metro-proyecto","folder":"metro/linea-1","elements":[],"camera":{"x":0,"y":0,"zoom":1}}'
```

### üì° Modo "Escucha" (IA -> Canvas en vivo)
Caso de uso: abrir un canvas (sticker/deck) y que la IA lo vaya actualizando sin que el humano toque botones.

1) Abre el visor en modo escucha:
* `/?mode=sticker&listen=mi-sesion`
* `/?mode=deck&listen=mi-sesion`

2) La IA (o cualquier cliente HTTP con permiso) env√≠a JSON al canal:
```bash
curl -sS -X POST "https://TU-DOMINIO.vercel.app/api/inject?session=mi-sesion" \
  -H "content-type: application/json" \
  # Opcional (solo si configuraste PUBLISH_KEY en Vercel):
  # -H "x-publish-key: TU_PUBLISH_KEY" \
  -d '{
    "name":"Tomorrowland-Gemini-Gate",
    "elements":[
      { "type":"circle", "x":400, "y":300, "radius":25, "color":"#00d4ff", "name":"NUCLEO IA GEMINI" },
      { "type":"line", "x1":400, "y1":325, "x2":400, "y2":500, "color":"#48ea79", "isAnim":true, "speed":3, "animColor":"#ffffff" }
    ],
    "camera": { "x": 0, "y": 0, "zoom": 1 }
  }'
```

El visor (con `listen=...`) hace polling y renderiza el √∫ltimo JSON inyectado.

Respuesta (ejemplo):
* `previewUrl`: `https://TU-DOMINIO.vercel.app/?mode=sticker&id=metro/linea-1/xxxx`
* `jsonUrl`: `https://TU-DOMINIO.vercel.app/api/project?id=metro/linea-1/xxxx`

### üëÅÔ∏è Links de visualizaci√≥n
* Ver sticker: `/?mode=sticker&id=CARPETA/ID`
* Ver preview: `/?mode=preview&id=CARPETA/ID` (equivalente)
* Cargar por URL externa: `/?mode=sticker&project=https://ejemplo.com/ruta.json`
* Cargar JSON embebido: `/?mode=sticker&data={...json...}` (usar URL encoding si es largo)
* Auto-carga opcional: `./project.json` (si existe en la misma carpeta y es JSON real)

---

## üìö Biblioteca (Stickers reutilizables dentro del editor)
El editor incluye:
* Botones **Publicar Vector** / **Publicar Proyecto**: publican el canvas actual y muestran links (preview + JSON).
* Bot√≥n **Biblioteca**: navega por carpetas (`prefix`) y permite **Insertar** stickers publicados.

Inserci√≥n:
* Un sticker se inserta como **1 solo elemento tipo `group`** para poder moverlo como objeto √∫nico.

## ü§ñ IA-Ready (Notas)
* No pongas llaves/tokens en el repo. Usa variables de entorno en Vercel (Environment Variables).
* Para **stickers vectoriales**: `POST /api/publish` (rechaza im√°genes).
* Para **proyectos con im√°genes**: `POST /api/publish-project` (sube assets y reemplaza `imageSrc` por URLs).
* Para **inyecci√≥n en vivo**: `POST /api/inject?session=...` y abre `/?mode=sticker&listen=...`.
